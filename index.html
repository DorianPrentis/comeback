<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BTC Goal</title>

<style>
body {
    background: white;
    font-family: Arial, sans-serif;
    text-align: center;
    padding-top: 60px;
}

.address {
    font-size: 16px;
    word-break: break-all;
    margin-bottom: 20px;
}

.goal {
    margin-top: 10px;
}

.progress-container {
    width: 60%;
    margin: 30px auto;
    background: #eee;
    height: 25px;
    border-radius: 20px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    width: 0%;
    background: black;
    transition: width 0.6s ease;
}

.qr {
    margin-top: 30px;
}

.usd {
    margin-top: 10px;
    font-size: 14px;
    opacity: 0.7;
}
</style>
</head>
<body>

<h2>Bitcoin Address</h2>
<p class="address">bc1q8f52zsffdgkxc2gk3rku2jmjzkkjzq0z8f6tvf</p>

<h3 id="balance">Loading balance...</h3>
<div class="usd" id="usdValue"></div>
<h3 class="goal">Goal: 33 BTC</h3>

<div class="progress-container">
  <div class="progress-bar" id="progress"></div>
</div>

<div class="qr">
  <img id="qrCode" width="180">
</div>

<script>
const address = "bc1q8f52zsffdgkxc2gk3rku2jmjzkkjzq0z8f6tvf";
const goal = 33;
let lastBalance = 0;

async function getBTCPrice() {
    const response = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd");
    const data = await response.json();
    return data.bitcoin.usd;
}

async function getBalance() {
    try {
        const response = await fetch(`https://blockstream.info/api/address/${address}`);
        const data = await response.json();

        const funded = data.chain_stats.funded_txo_sum;
        const spent = data.chain_stats.spent_txo_sum;
        const balanceBTC = (funded - spent) / 100000000;

        document.getElementById("balance").innerText =
            "Current: " + balanceBTC.toFixed(6) + " BTC";

        let percent = (balanceBTC / goal) * 100;
        if (percent > 100) percent = 100;
        document.getElementById("progress").style.width = percent + "%";

        const price = await getBTCPrice();
        const usd = balanceBTC * price;
        document.getElementById("usdValue").innerText =
            "â‰ˆ $" + usd.toLocaleString(undefined, {maximumFractionDigits: 0});

        if (balanceBTC > lastBalance) {
            document.body.style.background = "#f5f5f5";
            setTimeout(() => document.body.style.background = "white", 600);
        }

        lastBalance = balanceBTC;

    } catch (error) {
        document.getElementById("balance").innerText = "Error loading balance";
    }
}

document.getElementById("qrCode").src =
    "https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=" + address;

getBalance();
setInterval(getBalance, 60000);
</script>

</body>
</html>
